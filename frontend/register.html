<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscription - Auto-Entrepreneur Tunisie</title>
  <meta name="description" content="Rejoignez Auto-Entrepreneur Tunisie et commencez √† proposer vos services ou trouvez les meilleurs auto-entrepreneurs tunisiens.">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/homepage.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); min-height: 100vh; padding: 2rem 0;">

  <!-- Register Container -->
  <div class="container">
    <div style="max-width: 500px; margin: 0 auto;">

      <!-- Header -->
      <div class="text-center mb-8">
        <a href="home.html" class="inline-block mb-4">
          <h2 style="font-size: 2rem; font-weight: 900; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin: 0;">üáπüá≥ Auto-Entrepreneur</h2>
        </a>
        <h1 style="font-size: 2.5rem; font-weight: 800; color: white; margin-bottom: 1rem;">Rejoignez Auto-Entrepreneur Tunisie</h1>
        <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.125rem;">Cr√©ez votre compte et commencez d√®s aujourd'hui</p>
      </div>

      <!-- Account Type Selection -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
        <div class="account-type-card" data-type="autoentrepreneur" style="background: rgba(255, 255, 255, 0.9); padding: 2rem; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üíº</div>
          <h3 style="font-weight: 700; margin-bottom: 0.5rem; color: #1e293b;">Auto-Entrepreneur</h3>
          <p style="font-size: 0.875rem; color: #64748b;">Proposez vos services et trouvez des clients</p>
        </div>
        <div class="account-type-card" data-type="client" style="background: rgba(255, 255, 255, 0.9); padding: 2rem; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
          <h3 style="font-weight: 700; margin-bottom: 0.5rem; color: #1e293b;">Client</h3>
          <p style="font-size: 0.875rem; color: #64748b;">Trouvez et engagez des auto-entrepreneurs</p>
        </div>
      </div>

      <!-- Register Form -->
      <div class="card animate-fade-in">
        <form id="registerForm">
          <input type="hidden" name="type" id="selectedType" value="">

          <div class="grid grid-2 gap-4">
            <div class="form-group">
              <label class="form-label">Pr√©nom</label>
              <input type="text" name="firstName" class="form-input" placeholder="Ahmed" required>
            </div>
            <div class="form-group">
              <label class="form-label">Nom</label>
              <input type="text" name="lastName" class="form-input" placeholder="Ben Ali" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-input" placeholder="ahmed@example.com" required>
          </div>

          <div class="form-group">
            <label class="form-label">T√©l√©phone (optionnel)</label>
            <input type="tel" name="phone" class="form-input" placeholder="+216 XX XXX XXX">
          </div>

          <div class="form-group">
            <label class="form-label">Mot de passe</label>
            <input type="password" name="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
            <div class="text-xs text-gray-500 mt-1">Minimum 6 caract√®res</div>
          </div>

          <div class="form-group">
            <label class="form-label">Confirmer le mot de passe</label>
            <input type="password" name="confirmPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
          </div>

          <div class="form-group">
            <label class="flex items-start gap-3 text-sm">
              <input type="checkbox" name="terms" required class="mt-1">
              <span>
                J'accepte les <a href="#" class="text-primary hover:text-primary-dark">conditions d'utilisation</a>
                et la <a href="#" class="text-primary hover:text-primary-dark">politique de confidentialit√©</a>
              </span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary w-full mb-4" id="registerBtn">
            <span id="registerBtnText">üöÄ Cr√©er mon compte</span>
            <div id="registerSpinner" class="spinner hidden" style="width: 20px; height: 20px;"></div>
          </button>

          <div id="registerError" class="hidden"></div>
        </form>

        <!-- Divider -->
        <div class="flex items-center my-6">
          <div class="flex-1 border-t border-gray-300"></div>
          <span class="px-4 text-sm text-gray-500">ou</span>
          <div class="flex-1 border-t border-gray-300"></div>
        </div>

        <!-- Social Register -->
        <div class="space-y-3">
          <button class="btn btn-secondary w-full" onclick="showError('Inscription Google bient√¥t disponible')">
            üîç S'inscrire avec Google
          </button>
          <button class="btn btn-secondary w-full" onclick="showError('Inscription Facebook bient√¥t disponible')">
            üìò S'inscrire avec Facebook
          </button>
        </div>
      </div>

      <!-- Login Link -->
      <div class="text-center mt-6">
        <p class="text-white opacity-90">
          D√©j√† un compte ?
          <a href="login.html" class="text-white font-semibold hover:text-primary-light underline">
            Se connecter
          </a>
        </p>
      </div>

      <!-- Back to Home -->
      <div class="text-center mt-4">
        <a href="index.html" class="text-white opacity-75 hover:opacity-100 text-sm">
          ‚Üê Retour √† l'accueil
        </a>
      </div>

    </div>
  </div>

  <script>
    // Utility functions
    function showError(message) {
      const errorDiv = document.getElementById('registerError');
      errorDiv.innerHTML = `
        <div style="background: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 8px; border: 1px solid #fecaca; margin-top: 1rem;">
          <strong>Erreur:</strong> ${message}
        </div>
      `;
      errorDiv.classList.remove('hidden');
    }

    function showSuccess(message) {
      const errorDiv = document.getElementById('registerError');
      errorDiv.innerHTML = `
        <div style="background: #d1fae5; color: #065f46; padding: 1rem; border-radius: 8px; border: 1px solid #a7f3d0; margin-top: 1rem;">
          <strong>Succ√®s:</strong> ${message}
        </div>
      `;
      errorDiv.classList.remove('hidden');
    }
  </script>
  <script>
    // Account type selection
    document.querySelectorAll('.account-type-card').forEach(card => {
      card.addEventListener('click', function() {
        // Remove active class from all cards
        document.querySelectorAll('.account-type-card').forEach(c => {
          c.classList.remove('border-primary', 'bg-primary-light', 'bg-opacity-10');
          c.classList.add('border-gray-200');
        });

        // Add active class to clicked card
        this.classList.remove('border-gray-200');
        this.classList.add('border-primary', 'bg-primary-light', 'bg-opacity-10');

        // Set the hidden input value
        document.getElementById('selectedType').value = this.dataset.type;

        // Update form title based on selection
        const title = this.dataset.type === 'autoentrepreneur' ?
          'Cr√©er un compte Auto-Entrepreneur' :
          'Cr√©er un compte Client';
        document.querySelector('h1').textContent = title;
      });
    });

    // Check URL parameters for pre-selection
    const urlParams = new URLSearchParams(window.location.search);
    const preselectedType = urlParams.get('type');
    if (preselectedType) {
      const card = document.querySelector(`[data-type="${preselectedType}"]`);
      if (card) {
        card.click();
      }
    }

    // Form submission
    document.getElementById('registerForm').onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const registerBtn = document.getElementById('registerBtn');
      const registerBtnText = document.getElementById('registerBtnText');
      const registerSpinner = document.getElementById('registerSpinner');
      const errorDiv = document.getElementById('registerError');

      // Validation
      if (!form.selectedType.value) {
        errorDiv.innerHTML = `
          <div class="alert alert-error">
            <strong>Erreur:</strong> Veuillez s√©lectionner un type de compte
          </div>
        `;
        errorDiv.classList.remove('hidden');
        return;
      }

      if (form.password.value !== form.confirmPassword.value) {
        errorDiv.innerHTML = `
          <div class="alert alert-error">
            <strong>Erreur:</strong> Les mots de passe ne correspondent pas
          </div>
        `;
        errorDiv.classList.remove('hidden');
        return;
      }

      if (form.password.value.length < 6) {
        errorDiv.innerHTML = `
          <div class="alert alert-error">
            <strong>Erreur:</strong> Le mot de passe doit contenir au moins 6 caract√®res
          </div>
        `;
        errorDiv.classList.remove('hidden');
        return;
      }

      // Show loading state
      registerBtn.disabled = true;
      registerBtnText.classList.add('hidden');
      registerSpinner.classList.remove('hidden');
      errorDiv.classList.add('hidden');

      try {
        const userData = {
          name: `${form.firstName.value} ${form.lastName.value}`,
          email: form.email.value,
          phone: form.phone.value || null,
          password: form.password.value,
          type: form.selectedType.value
        };

        console.log('Sending registration data:', userData); // Debug log

        const response = await fetch('http://localhost:8000/backend/index.php?route=api/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(userData)
        });

        console.log('Response status:', response.status); // Debug log
        const data = await response.json();
        console.log('Registration response:', data); // Debug log

        if (data.success) {
          // Show success state
          registerBtnText.textContent = '‚úÖ Compte cr√©√©!';
          registerBtnText.classList.remove('hidden');
          registerSpinner.classList.add('hidden');

          showSuccess('Inscription r√©ussie! Redirection vers la connexion...');

          setTimeout(() => {
            window.location.href = 'login.html';
          }, 2000);
        } else {
          throw new Error(data.error || 'Erreur lors de l\'inscription');
        }
      } catch (error) {
        console.error('Registration error:', error); // Debug log
        // Show error state
        registerBtn.disabled = false;
        registerBtnText.textContent = 'üöÄ Cr√©er mon compte';
        registerBtnText.classList.remove('hidden');
        registerSpinner.classList.add('hidden');

        errorDiv.innerHTML = `
          <div class="alert alert-error">
            <strong>Erreur d'inscription:</strong> ${error.message || 'Une erreur est survenue'}
          </div>
        `;
        errorDiv.classList.remove('hidden');
      }
    }

    // Auto-focus on first name field
    document.querySelector('input[name="firstName"]').focus();

    // Password strength indicator
    document.querySelector('input[name="password"]').addEventListener('input', function(e) {
      const password = e.target.value;
      const strength = getPasswordStrength(password);

      // You can add a password strength indicator here
    });

    function getPasswordStrength(password) {
      let strength = 0;
      if (password.length >= 6) strength++;
      if (password.match(/[a-z]/)) strength++;
      if (password.match(/[A-Z]/)) strength++;
      if (password.match(/[0-9]/)) strength++;
      if (password.match(/[^a-zA-Z0-9]/)) strength++;
      return strength;
    }

    // Check if user is already logged in
    function isLoggedIn() {
      return localStorage.getItem('jwt') !== null;
    }

    if (isLoggedIn()) {
      showSuccess('Vous √™tes d√©j√† connect√©! Redirection...');
      setTimeout(() => {
        window.location.href = 'dashboard.html';
      }, 1000);
    }
  </script>
</body>
</html>
